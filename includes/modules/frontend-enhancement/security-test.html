<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WP Genius Reader å®‰å…¨æ€§æµ‹è¯•</title>
    
    <!-- Include Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Reader CSS -->
    <link rel="stylesheet" href="assets/css/reader.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .security-test {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .page-structure {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .expected-result {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .debug-info {
            background: #e2e3e5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .container-check {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .container-status {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .found {
            background: #d4edda;
            color: #155724;
        }
        
        .not-found {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-shield-alt"></i> WP Genius Reader å®‰å…¨æ€§æµ‹è¯•</h1>
    
    <div class="security-test">
        <h2><i class="fas fa-exclamation-triangle"></i> é‡è¦å®‰å…¨è¯´æ˜</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•ReaderåŠŸèƒ½çš„å®‰å…¨æ€§ï¼Œç¡®ä¿ï¼š</p>
        <ul>
            <li>âœ… ReaderåŠŸèƒ½åªåœ¨å­˜åœ¨ <code>#w2p-book-chapters</code> å®¹å™¨çš„é¡µé¢æ¿€æ´»</li>
            <li>âœ… ä¸ä¼šåˆ›å»ºä»»ä½•å¤‡ç”¨å®¹å™¨æˆ–ä¿®æ”¹é¡µé¢ç»“æ„</li>
            <li>âœ… åœ¨ä¸å«ç›®æ ‡å®¹å™¨çš„é¡µé¢å®Œå…¨æ— æ“ä½œ</li>
            <li>âœ… ä¸å½±å“å…¶ä»–é¡µé¢å…ƒç´ å’ŒåŠŸèƒ½</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2><i class="fas fa-search"></i> é¡µé¢å®¹å™¨æ£€æµ‹</h2>
        <p>æ£€æŸ¥å½“å‰é¡µé¢æ˜¯å¦åŒ…å«ReaderåŠŸèƒ½æ‰€éœ€çš„ç›®æ ‡å®¹å™¨ï¼š</p>
        
        <div class="container-check">
            <div class="container-status <?php echo file_exists('assets/css/reader.css') ? 'found' : 'not-found'; ?>">
                <i class="fas fa-file-code"></i> #w2p-book-chapters: <span id="target-container-status">æ£€æµ‹ä¸­...</span>
            </div>
        </div>
        
        <div class="page-structure">
            <strong>é¡µé¢DOMç»“æ„ï¼š</strong><br>
            <body><br>
            &nbsp;&nbsp;<h1>å®‰å…¨æ€§æµ‹è¯•é¡µé¢</h1><br>
            &nbsp;&nbsp;<div class="test-section">...</div><br>
            &nbsp;&nbsp;<div class="another-section">...</div><br>
            &nbsp;&nbsp;<!-- æ³¨æ„ï¼šæ­¤é¡µé¢æ²¡æœ‰ #w2p-book-chapters å®¹å™¨ --><br>
            </body>
        </div>
    </div>
    
    <div class="test-section">
        <h2><i class="fas fa-cogs"></i> ReaderåŠŸèƒ½çŠ¶æ€</h2>
        
        <div class="expected-result">
            <h4><i class="fas fa-check-circle"></i> é¢„æœŸç»“æœ</h4>
            <p>ç”±äºæ­¤é¡µé¢<strong>æ²¡æœ‰</strong> <code>#w2p-book-chapters</code> å®¹å™¨ï¼ŒReaderåŠŸèƒ½åº”è¯¥ï¼š</p>
            <ul>
                <li>âŒ ä¸æ˜¾ç¤ºå·¥å…·æ </li>
                <li>âŒ ä¸åˆ›å»ºè¿›åº¦æ¡</li>
                <li>âŒ ä¸ä¿®æ”¹ä»»ä½•é¡µé¢å…ƒç´ </li>
                <li>âœ… æ§åˆ¶å°æ˜¾ç¤ºå®‰å…¨é€€å‡ºä¿¡æ¯</li>
                <li>âœ… ä¿æŒé¡µé¢åŸå§‹ç»“æ„</li>
            </ul>
        </div>
        
        <div class="debug-info" id="reader-debug">
            <strong>ReaderçŠ¶æ€ç›‘æ§:</strong><br>
            é¡µé¢åŠ è½½æ—¶é—´: <span id="load-time">æ£€æµ‹ä¸­...</span><br>
            Readeråˆå§‹åŒ–: <span id="init-status">ç­‰å¾…ä¸­...</span><br>
            å·¥å…·æ çŠ¶æ€: <span id="toolbar-status">æœªæ£€æµ‹åˆ°</span><br>
            è¿›åº¦æ¡çŠ¶æ€: <span id="progress-status">æœªæ£€æµ‹åˆ°</span><br>
            é¡µé¢ä¿®æ”¹: <span id="page-modifications">æ— </span>
        </div>
    </div>
    
    <div class="test-section">
        <h2><i class="fas fa-list"></i> å…¶ä»–é¡µé¢å…ƒç´ </h2>
        <p>æ­¤åŒºåŸŸåŒ…å«å¸¸è§çš„é¡µé¢å…ƒç´ ï¼ŒéªŒè¯Readerä¸ä¼šæ„å¤–ä¿®æ”¹å®ƒä»¬ï¼š</p>
        
        <div class="another-section">
            <h3>æ™®é€šå†…å®¹åŒºåŸŸ</h3>
            <p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„ <code><div></code> å®¹å™¨ï¼Œåº”è¯¥ä¿æŒåŸæ ·ã€‚</p>
            <p>åŒ…å«ä¸€äº› <strong>ç²—ä½“æ–‡å­—</strong> å’Œ <em>æ–œä½“æ–‡å­—</em>ã€‚</p>
            
            <ul>
                <li>åˆ—è¡¨é¡¹1</li>
                <li>åˆ—è¡¨é¡¹2</li>
                <li>åˆ—è¡¨é¡¹3</li>
            </ul>
            
            <button onclick="testButtonClick()">æµ‹è¯•æŒ‰é’®</button>
            <input type="text" placeholder="æµ‹è¯•è¾“å…¥æ¡†" style="padding: 5px; margin: 5px;">
        </div>
    </div>
    
    <div class="warning">
        <h4><i class="fas fa-info-circle"></i> æµ‹è¯•è¯´æ˜</h4>
        <p>å¦‚æœReaderåŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œæ­¤é¡µé¢åº”è¯¥ï¼š</p>
        <ol>
            <li>åœ¨æ§åˆ¶å°æ˜¾ç¤º "Reader will not be initialized on this page" ä¿¡æ¯</li>
            <li>ä¸æ˜¾ç¤ºä»»ä½•Readerç›¸å…³çš„UIå…ƒç´ </li>
            <li>æ‰€æœ‰å…¶ä»–é¡µé¢å…ƒç´ ä¿æŒåŸæ ·</li>
            <li>ç‚¹å‡»æµ‹è¯•æŒ‰é’®åº”è¯¥æ˜¾ç¤ºæ­£å¸¸alert</li>
        </ol>
    </div>
    
    <script>
        // Mock WordPress configuration
        window.wpgReaderConfig = {
            postId: 123,
            settings: {
                reader_enabled: true,
                reader_font_size: 18,
                reader_font_family: 'sans',
                reader_theme: 'light'
            }
        };
        
        // Mock default settings
        window.wpgReaderDefaults = {
            fontSize: 18,
            fontFamily: 'sans',
            theme: 'light'
        };
        
        // Page monitoring
        let pageLoadTime = Date.now();
        
        // Check for target container
        function checkTargetContainer() {
            const $target = $('#w2p-book-chapters');
            const statusEl = document.getElementById('target-container-status');
            
            if ($target.length > 0) {
                statusEl.innerHTML = '<i class="fas fa-check"></i> æ‰¾åˆ° (åº”è¯¥åˆå§‹åŒ–)';
                statusEl.className = 'found';
            } else {
                statusEl.innerHTML = '<i class="fas fa-times"></i> æœªæ‰¾åˆ° (åº”è¯¥è·³è¿‡)';
                statusEl.className = 'not-found';
            }
        }
        
        // Monitor Reader status
        function monitorReaderStatus() {
            const initStatusEl = document.getElementById('init-status');
            const toolbarStatusEl = document.getElementById('toolbar-status');
            const progressStatusEl = document.getElementById('progress-status');
            const pageModEl = document.getElementById('page-modifications');
            
            // Check if Reader attempted initialization
            if (window.wpGeniusReader) {
                initStatusEl.innerHTML = '<i class="fas fa-check"></i> å·²åˆå§‹åŒ–';
            } else {
                initStatusEl.innerHTML = '<i class="fas fa-times"></i> æœªåˆå§‹åŒ– (å®‰å…¨)';
            }
            
            // Check for toolbar
            const $toolbar = $('#wpg-reader-toolbar');
            toolbarStatusEl.innerHTML = $toolbar.length > 0 ? 
                '<i class="fas fa-check"></i> å·²åˆ›å»º' : 
                '<i class="fas fa-times"></i> æœªåˆ›å»º (å®‰å…¨)';
            
            // Check for progress bar
            const $progress = $('#wpg-reader-progress-bar');
            progressStatusEl.innerHTML = $progress.length > 0 ? 
                '<i class="fas fa-check"></i> å·²åˆ›å»º' : 
                '<i class="fas fa-times"></i> æœªåˆ›å»º (å®‰å…¨)';
            
            // Check page modifications
            const hasModifications = $toolbar.length > 0 || $progress.length > 0;
            pageModEl.innerHTML = hasModifications ? 
                '<i class="fas fa-exclamation"></i> æœ‰ä¿®æ”¹' : 
                '<i class="fas fa-check"></i> æ— ä¿®æ”¹ (å®‰å…¨)';
        }
        
        // Test button function
        window.testButtonClick = function() {
            alert('æŒ‰é’®ç‚¹å‡»æ­£å¸¸ï¼é¡µé¢ç»“æ„æœªè¢«ç ´åã€‚');
        };
        
        // Update load time
        document.getElementById('load-time').textContent = (Date.now() - pageLoadTime) + 'ms';
        
        // Initialize monitoring
        $(document).ready(function() {
            console.log('ğŸ”’ å®‰å…¨æ€§æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ğŸ” æ£€æŸ¥ç›®æ ‡å®¹å™¨...');
            
            checkTargetContainer();
            
            // Monitor Reader status every second
            setInterval(monitorReaderStatus, 1000);
            
            // Check after Reader initialization
            setTimeout(() => {
                monitorReaderStatus();
                console.log('ğŸ“Š ReaderçŠ¶æ€æ£€æŸ¥å®Œæˆ');
            }, 2000);
        });
    </script>
    
    <!-- Reader JavaScript -->
    <script src="assets/js/reader.js"></script>
    
    <script>
        // Final check after Reader loads
        $(document).ready(function() {
            setTimeout(() => {
                monitorReaderStatus();
                console.log('ğŸ›¡ï¸ å®‰å…¨æ€§æµ‹è¯•å®Œæˆ - Readeråº”è¯¥åœ¨æ²¡æœ‰ç›®æ ‡å®¹å™¨çš„é¡µé¢ä¿æŒé™é»˜');
            }, 3000);
        });
    </script>
</body>
</html>