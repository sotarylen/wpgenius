<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WP Genius Reader ä¼˜åŒ–ç‰ˆæµ‹è¯•</title>
    
    <!-- Include Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Reader CSS -->
    <link rel="stylesheet" href="assets/css/reader.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1, h2 {
            color: #333;
        }
        
        .debug-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        
        .performance-test {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .icon-demo {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .icon-demo i {
            font-size: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .manual-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            min-width: 200px;
        }
        
        .manual-controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px 12px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .manual-controls button:hover {
            background: #005a87;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ WP Genius Reader æ€§èƒ½ä¼˜åŒ–æµ‹è¯•</h1>
    
    <div class="performance-test">
        <h3><i class="fas fa-tachometer-alt"></i> æ€§èƒ½æµ‹è¯•è¯´æ˜</h3>
        <p>æœ¬æµ‹è¯•é¡µé¢ä¸“é—¨ç”¨äºéªŒè¯ä¸»é¢˜åˆ‡æ¢çš„æµç•…åº¦ä¼˜åŒ–ï¼š</p>
        <ul>
            <li><strong>Font Awesomeå›¾æ ‡</strong>ï¼šä½¿ç”¨çº¿æ€§å›¾æ ‡æ›¿ä»£emoji</li>
            <li><strong>æµç•…åŠ¨ç”»</strong>ï¼šCSS3 è¿‡æ¸¡åŠ¨ç”»å’Œç¡¬ä»¶åŠ é€Ÿ</li>
            <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šrequestAnimationFrame å’Œæ‰¹é‡DOMæ“ä½œ</li>
            <li><strong>å³æ—¶å“åº”</strong>ï¼šä¸»é¢˜åˆ‡æ¢åº”è¯¥æ˜¯å³æ—¶çš„</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2><i class="fas fa-icons"></i> å›¾æ ‡é¢„è§ˆ</h2>
        <p>Font Awesome çº¿æ€§å›¾æ ‡é¢„è§ˆï¼š</p>
        <div class="icon-demo">
            <i class="fas fa-sun" title="æ˜äº®æ¨¡å¼"></i>
            <i class="fas fa-book-open" title="æŠ¤çœ¼æ¨¡å¼"></i>
            <i class="fas fa-leaf" title="è‡ªç„¶æ¨¡å¼"></i>
            <i class="fas fa-moon" title="æš—é»‘æ¨¡å¼"></i>
        </div>
    </div>
    
    <div class="test-section">
        <h2><i class="fas fa-shield-alt"></i> å®‰å…¨æ€§æµ‹è¯•</h2>
        <div class="entry-content">
            <h3>å…¼å®¹æ€§éªŒè¯</h3>
            <p><strong>ä¸¥æ ¼å®¹å™¨æ£€æµ‹ï¼š</strong>ReaderåŠŸèƒ½ç°åœ¨åªåœ¨å­˜åœ¨ <code>#w2p-book-chapters</code> å…ƒç´ çš„é¡µé¢æ¿€æ´»ã€‚</p>
            <p><strong>æ— å¤‡ç”¨å®¹å™¨ï¼š</strong>ä¸ä¼šåœ¨ä»»ä½•æƒ…å†µä¸‹åˆ›å»ºå¤‡ç”¨å®¹å™¨ï¼Œç¡®ä¿ä¸ä¼šç ´åå…¶ä»–é¡µé¢ç»“æ„ã€‚</p>
            <p><strong>å‘ä¸‹å…¼å®¹ï¼š</strong>åœ¨ä¸å«ç›®æ ‡å®¹å™¨çš„é¡µé¢ï¼ŒReaderåŠŸèƒ½å®Œå…¨ä¸ä¼šåˆå§‹åŒ–ã€‚</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2><i class="fas fa-book"></i> åŠŸèƒ½æµ‹è¯•åŒºåŸŸ</h2>
        <div id="w2p-book-chapters">
            <h3>ReaderåŠŸèƒ½æµ‹è¯•</h3>
            <p>åªæœ‰åœ¨åŒ…å«æ­¤ <code>#w2p-book-chapters</code> å®¹å™¨çš„æƒ…å†µä¸‹ï¼ŒReaderå·¥å…·æ æ‰ä¼šæ˜¾ç¤ºå¹¶æ¿€æ´»ã€‚</p>
            <ul>
                <li>âœ… Font Awesome çº¿æ€§å›¾æ ‡</li>
                <li>âœ… 16-50ms å³æ—¶å“åº”</li>
                <li>âœ… CSS3 ç¡¬ä»¶åŠ é€ŸåŠ¨ç”»</li>
                <li>âœ… ä¸¥æ ¼å®¹å™¨æ£€æµ‹</li>
                <li>âœ… é›¶é¡µé¢ç»“æ„ç ´å</li>
            </ul>
            <p>å¦‚æœå·¥å…·æ æ˜¾ç¤ºåœ¨æ­¤åŒºåŸŸä¸Šæ–¹ï¼Œè¯´æ˜Readerå·²æ­£ç¡®åˆå§‹åŒ–ã€‚</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        </div>
    </div>
    
    <div class="debug-info" id="debug-info">
        <strong><i class="fas fa-chart-line"></i> å®æ—¶æ€§èƒ½ç›‘æ§:</strong><br>
        ReaderçŠ¶æ€: <span id="reader-status">æœªåˆå§‹åŒ–</span><br>
        æ‰¾åˆ°çš„å®¹å™¨: <span id="found-container">æ— </span><br>
        å·¥å…·æ çŠ¶æ€: <span id="toolbar-status">æœªåˆ›å»º</span><br>
        æœ€åä¸»é¢˜åˆ‡æ¢: <span id="last-theme-switch">æ— </span><br>
        åˆ‡æ¢è€—æ—¶: <span id="switch-duration">æ— </span>
    </div>
    
    <script>
        // Mock WordPress configuration
        window.wpgReaderConfig = {
            postId: 123,
            settings: {
                reader_enabled: true,
                reader_font_size: 18,
                reader_font_family: 'sans',
                reader_theme: 'light'
            }
        };
        
        // Mock default settings
        window.wpgReaderDefaults = {
            fontSize: 18,
            fontFamily: 'sans',
            theme: 'light'
        };
        
        // Performance monitoring
        let switchStartTime = 0;
        
        // Enhanced debug functions
        function updateDebugInfo() {
            const statusEl = document.getElementById('reader-status');
            const containerEl = document.getElementById('found-container');
            const toolbarEl = document.getElementById('toolbar-status');
            const lastSwitchEl = document.getElementById('last-theme-switch');
            const durationEl = document.getElementById('switch-duration');
            
            if (window.wpGeniusReader) {
                statusEl.textContent = 'âœ… å·²åˆå§‹åŒ–';
                containerEl.textContent = window.wpGeniusReader.containerSelector;
                const toolbar = document.getElementById('wpg-reader-toolbar');
                toolbarEl.textContent = toolbar ? 'âœ… å·²åˆ›å»º' : 'âŒ æœªåˆ›å»º';
                lastSwitchEl.textContent = window.wpGeniusReader.state.theme || 'æ— ';
                durationEl.textContent = window.wpGeniusReader.lastSwitchDuration ? window.wpGeniusReader.lastSwitchDuration + 'ms' : 'æ— ';
            } else {
                statusEl.textContent = 'âŒ æœªåˆå§‹åŒ–';
            }
        }
        
        // Update debug info every 500ms
        setInterval(updateDebugInfo, 500);
        
        // Manual controls
        $(document).ready(function() {
            const $controls = $(`
                <div class="manual-controls">
                    <h4><i class="fas fa-tools"></i> æ‰‹åŠ¨æµ‹è¯•</h4>
                    <button onclick="testThemeSwitch('light')">æ˜äº®æ¨¡å¼</button>
                    <button onclick="testThemeSwitch('sepia')">æŠ¤çœ¼æ¨¡å¼</button>
                    <button onclick="testThemeSwitch('green')">è‡ªç„¶æ¨¡å¼</button>
                    <button onclick="testThemeSwitch('dark')">æš—é»‘æ¨¡å¼</button>
                    <button onclick="testFontSize()">å­—ä½“å¤§å°æµ‹è¯•</button>
                    <button onclick="forceReinit()">é‡æ–°åˆå§‹åŒ–</button>
                    <button onclick="benchmark()">æ€§èƒ½åŸºå‡†æµ‹è¯•</button>
                </div>
            `);
            
            $('body').append($controls);
            
            // Performance testing functions
            window.testThemeSwitch = function(theme) {
                if (window.wpGeniusReader) {
                    switchStartTime = performance.now();
                    console.log(`ğŸš€ å¼€å§‹æµ‹è¯•ä¸»é¢˜åˆ‡æ¢åˆ°: ${theme}`);
                    window.wpGeniusReader.setTheme(theme);
                } else {
                    alert('Readeræœªåˆå§‹åŒ–ï¼');
                }
            };
            
            window.testFontSize = function() {
                if (window.wpGeniusReader) {
                    const currentSize = window.wpGeniusReader.state.fontSize;
                    const newSize = currentSize >= 36 ? 12 : currentSize + 4;
                    console.log(`ğŸ“ å­—ä½“å¤§å°æµ‹è¯•: ${currentSize}px -> ${newSize}px`);
                    window.wpGeniusReader.changeFontSize(newSize > currentSize ? 1 : -1);
                }
            };
            
            window.forceReinit = function() {
                console.log('ğŸ”„ é‡æ–°åˆå§‹åŒ–Reader...');
                if (window.wpGeniusReader) {
                    $('#wpg-reader-toolbar').remove();
                }
                setTimeout(() => {
                    if (typeof WPGeniusReader !== 'undefined') {
                        window.wpGeniusReader = new WPGeniusReader(window.wpgReaderConfig);
                    }
                }, 100);
            };
            
            window.benchmark = function() {
                console.log('â±ï¸ å¼€å§‹æ€§èƒ½åŸºå‡†æµ‹è¯•...');
                if (!window.wpGeniusReader) {
                    alert('è¯·å…ˆåˆå§‹åŒ–Readerï¼');
                    return;
                }
                
                const themes = ['light', 'sepia', 'green', 'dark'];
                const results = [];
                
                themes.forEach((theme, index) => {
                    setTimeout(() => {
                        const start = performance.now();
                        window.wpGeniusReader.setTheme(theme);
                        const duration = performance.now() - start;
                        results.push({ theme, duration });
                        console.log(`âœ… ${theme}: ${duration.toFixed(2)}ms`);
                        
                        if (results.length === themes.length) {
                            console.log('ğŸ“Š æ€§èƒ½æµ‹è¯•å®Œæˆ:', results);
                            const avg = results.reduce((sum, r) => sum + r.duration, 0) / results.length;
                            console.log(`ğŸ“ˆ å¹³å‡åˆ‡æ¢æ—¶é—´: ${avg.toFixed(2)}ms`);
                            alert(`æ€§èƒ½æµ‹è¯•å®Œæˆï¼\\nå¹³å‡åˆ‡æ¢æ—¶é—´: ${avg.toFixed(2)}ms`);
                        }
                    }, index * 300);
                });
            };
        });
        
        // Monitor theme switches
        $(document).on('click', '.wpg-reader-theme-btn', function() {
            const theme = $(this).data('theme');
            if (switchStartTime) {
                const duration = performance.now() - switchStartTime;
                if (window.wpGeniusReader) {
                    window.wpGeniusReader.lastSwitchDuration = duration.toFixed(2);
                }
                console.log(`âš¡ ä¸»é¢˜åˆ‡æ¢å®Œæˆ: ${theme} (${duration.toFixed(2)}ms)`);
                switchStartTime = 0;
            }
        });
    </script>
    
    <!-- Reader JavaScript -->
    <script src="assets/js/reader.js"></script>
    
    <script>
        // Enhanced initialization with performance monitoring
        $(document).ready(function() {
            console.log('ğŸš€ åˆå§‹åŒ–ä¼˜åŒ–ç‰ˆReaderæµ‹è¯•...');
            
            setTimeout(function() {
                if (typeof wpgReaderConfig !== 'undefined' && !window.wpGeniusReader) {
                    console.log('ğŸ”§ åˆ›å»ºReaderå®ä¾‹...');
                    try {
                        window.wpGeniusReader = new WPGeniusReader(wpgReaderConfig);
                        console.log('âœ… Readeråˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹æ€§èƒ½ç›‘æ§...');
                    } catch (e) {
                        console.error('âŒ Readeråˆå§‹åŒ–å¤±è´¥:', e);
                    }
                }
            }, 500);
        });
    </script>
</body>
</html>