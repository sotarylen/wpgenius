(function(){var i=window.iwArgsUpload||{},c=i.uploadContextKey||"iw_watermark_upload",v=i.uploadContextValue||"1",p=["image/gif","image/jpeg","image/png","image/webp"],r={frame:null},I=function(e,t){if(!e)return!1;var a=e.matches||e.msMatchesSelector||e.webkitMatchesSelector;return a?a.call(e,t):!1},g=function(e,t){for(var a=e;a;){if(I(a,t))return a;a=a.parentElement}return null},u=function(e){var t=document.querySelector("div#previewImg_imageDiv img#previewImg_image");t&&(t.src=e,t.style.display=e?"":"none")},m=function(e,t,a){t===void 0&&(t=0),a===void 0&&(a=0);var o=document.querySelector("#iw-watermark-preview-image");o&&(o.src=e||"",o.style.width="",o.style.height="",o.setAttribute("data-natural-width",t||0),o.setAttribute("data-natural-height",a||0),o.addEventListener("load",function(){window.iw&&typeof window.iw.updatePreview=="function"&&window.iw.updatePreview()})),document.dispatchEvent(new CustomEvent("iwPreviewImageChange")),window.iw&&typeof window.iw.updatePreview=="function"&&window.iw.updatePreview()},l=function(e){var t=document.querySelector("p#previewImageInfo");t&&(t.innerHTML=e)},w=function(e){var t=document.querySelector("#iw-watermark-image-ui-remove");t&&(t.disabled=e)},h=function(){if(r.frame){var e=r.frame.state().get("selection"),t=e&&e.first?e.first():null;if(!(!t||!t.attributes)){var a=t.attributes,o=a.mime,s=a.url,P=a.id;if(p.indexOf(o)!==-1){var d=document.querySelector("#iw-watermark-image-ui-input");d&&(d.value=P),u(s),w(!1);var b=new Image;b.src=s,b.onload=function(){l(i.originalSize+": "+this.width+" "+i.px+" / "+this.height+" "+i.px),m(s,this.width,this.height)},d&&d.dispatchEvent(new Event("change",{bubbles:!0}))}else{w(!0);var S=document.querySelector("#iw-watermark-image-ui-input");S&&(S.value=0),u(""),m("",0,0),l("<strong>"+i.notAllowedImg+"</strong>")}}}},f=function(){if(!(!r.frame||!r.frame.uploader)){var e=r.frame.uploader.uploader;if(e&&typeof e.param=="function"){e.param(c,v);return}var t=r.frame.uploader.options&&r.frame.uploader.options.uploader&&r.frame.uploader.options.uploader.params;t&&(t[c]=v)}},y=function(){return r.frame||(r.frame=wp.media({title:i.title,frame:i.frame,button:i.button,multiple:i.multiple,library:{type:p}}),r.frame.on("select",h),r.frame.on("open",f),r.frame.on("open",function(){r.frame.$el.addClass("iw-is-watermark-selector")}),r.frame.on("uploader:ready",f),f()),r.frame};typeof window!="undefined"&&(window.iw=window.iw||{},window.iw.adminUpload=Object.assign(window.iw.adminUpload||{},{setPreviewImage:u,setImageInfo:l,toggleDisableOffButton:w,syncLivePreview:m,handleSelect:h,setUploadContextParam:f,getFrame:y,_resetFrame:function(){r.frame=null}})),document.addEventListener("DOMContentLoaded",function(){var n=document.querySelector("#wpbody")||document;n.addEventListener("click",function(e){var t=g(e.target,"input#iw-watermark-image-ui-select");t&&(e.preventDefault(),y().open())}),document.addEventListener("click",function(e){var t=g(e.target,"#iw-watermark-image-ui-remove");if(t){e.preventDefault(),t.disabled=!0;var a=document.querySelector("#iw-watermark-image-ui-input");a&&(a.value=0),u(""),m("",0,0),l(i.noSelectedImg)}})})})();
